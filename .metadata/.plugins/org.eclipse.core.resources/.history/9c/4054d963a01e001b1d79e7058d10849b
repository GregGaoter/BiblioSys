package com.dsi.bibliosys.biblioback.mapper;

import static org.assertj.core.api.Assertions.assertThat;

import java.time.LocalDateTime;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.springframework.test.util.ReflectionTestUtils;

import com.dsi.bibliosys.biblioback.TestCase;
import com.dsi.bibliosys.biblioback.app.exception.NotNullIdException;
import com.dsi.bibliosys.biblioback.data.dto.UsagerDto;
import com.dsi.bibliosys.biblioback.data.entity.Adresse;
import com.dsi.bibliosys.biblioback.data.entity.Identifiant;
import com.dsi.bibliosys.biblioback.data.entity.Usager;
import com.dsi.bibliosys.biblioback.mapper.UsagerMapper;

@ExtendWith(SpringExtension.class)
@SpringBootTest
@Tag(TestCase.UNIT)
public class UsagerMapperTest {

	@Autowired
	private UsagerMapper usagerMapper;

	@Test
	public void mapToDto() {
		Identifiant identifiant = new Identifiant();
		ReflectionTestUtils.setField(identifiant, Usager.ID, 1);
		Adresse adresse = new Adresse();
		ReflectionTestUtils.setField(adresse, Usager.ID, 2);
		Usager usager = new Usager();
		ReflectionTestUtils.setField(usager, Usager.ID, 3);
		usager.setPrenom("Vincent");
		usager.setNom("Senapus");
		usager.setDateNaissance(LocalDateTime.of(1979, 6, 5, 23, 37));
		usager.setIdentifiant(identifiant);
		usager.setAdresse(adresse);

		UsagerDto usagerDto = usagerMapper.mapToDto(usager);

		assertThat(usagerDto.getId()).isEqualTo(3);
		assertThat(usagerDto.getPrenom()).isEqualTo("Vincent");
		assertThat(usagerDto.getNom()).isEqualTo("Senapus");
		assertThat(usagerDto.getDateNaissance()).isEqualTo(LocalDateTime.of(1979, 6, 5, 23, 37));
		assertThat(usagerDto.getIdentifiantId()).isEqualTo(1);
		assertThat(usagerDto.getAdresseId()).isEqualTo(2);
	}
	
	@Test
	public void mapToEntity_IdNull() throws NotNullIdException {
		UsagerDto usagerDto=new UsagerDto();
		usagerDto.setPrenom("Vincent");
		usagerDto.setNom("Senapus");
		usagerDto.setDateNaissance(LocalDateTime.of(1979, 6, 5, 23, 37));
		usagerDto.setIdentifiantId(1);
		usagerDto.setAdresseId(2);
		
		Usager usager=usagerMapper.mapToEntity(usagerDto);
		
		assertThat(usager.getId()).isNull();
		assertThat(usager.getPrenom()).isEqualTo("Vincent");
		assertThat(usager.getNom()).isEqualTo("Senapus");
		assertThat(usager.getDateNaissance()).isEqualTo(LocalDateTime.of(1979, 6, 5, 23, 37));
		assertThat(usager.getIdentifiantId()).isEqualTo(1);
		assertThat(usager.getAdresseId()).isEqualTo(2);
	}

}
